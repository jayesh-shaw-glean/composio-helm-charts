<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troubleshooting - Composio Helm Charts</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <i class="fas fa-cube"></i>
                <span>Composio Helm Charts</span>
            </a>
            <div class="nav-menu">
                <a href="index.html#quickstart" class="nav-link">Quick Start</a>
                <a href="architecture.html" class="nav-link">Architecture</a>
                <a href="configuration.html" class="nav-link">Configuration</a>
                <a href="guides.html" class="nav-link">Guides</a>
                <a href="troubleshooting.html" class="nav-link active">Troubleshooting</a>
                <a href="changelog.html" class="nav-link">Changelog</a>
                <a href="load-tests.html" class="nav-link">Load Tests</a>
            </div>
            <button class="mobile-nav-toggle" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="mobile-nav-menu">
            <a href="index.html#quickstart" class="nav-link">Quick Start</a>
            <a href="architecture.html" class="nav-link">Architecture</a>
            <a href="configuration.html" class="nav-link">Configuration</a>
            <a href="guides.html" class="nav-link">Guides</a>
            <a href="troubleshooting.html" class="nav-link active">Troubleshooting</a>
            <a href="changelog.html" class="nav-link">Changelog</a>
            <a href="load-tests.html" class="nav-link">Load Tests</a>
        </div>
    </nav>

    <main class="main-content">
        <section class="section">
            <div class="container">
                <h1><i class="fas fa-wrench"></i> Troubleshooting Guide</h1>
                <p class="subtitle">Solutions to common issues and debugging strategies</p>

                <div class="troubleshoot-nav">
                    <a href="#common" class="troubleshoot-nav-link">Common Issues</a>
                    <a href="#knative" class="troubleshoot-nav-link">Knative</a>
                    <a href="#database" class="troubleshoot-nav-link">Database</a>
                    <a href="#gke" class="troubleshoot-nav-link">GKE Specific</a>
                    <a href="#resources" class="troubleshoot-nav-link">Resources</a>
                    <a href="#debugging" class="troubleshoot-nav-link">Debug Tools</a>
                </div>

                <div id="common" class="troubleshoot-section">
                    <h2><i class="fas fa-exclamation-circle"></i> Common Issues</h2>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Pods Not Starting</h3>
                        <div class="issue-content">
                            <h4>Symptoms:</h4>
                            <ul>
                                <li>Pods stuck in <code>Pending</code> or <code>CrashLoopBackOff</code></li>
                                <li>ImagePullBackOff errors</li>
                            </ul>

                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check pod status
kubectl get pods -n composio

# Describe problematic pod
kubectl describe pod &lt;pod-name&gt; -n composio

# Check pod logs
kubectl logs &lt;pod-name&gt; -n composio

# Check events
kubectl get events -n composio --sort-by='.lastTimestamp'</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li><strong>ImagePullBackOff:</strong> Verify ECR credentials are correct
                                    <div class="code-block">
                                        <pre><code class="language-bash"># Recreate ECR secret
kubectl delete secret ecr-secret -n composio
helm upgrade composio ./composio -n composio \
    --set externalSecrets.ecr.token="$(aws ecr get-login-password --region us-east-1)"</code></pre>
                                    </div>
                                </li>
                                <li><strong>Insufficient Resources:</strong> Check cluster has enough CPU/memory
                                    <div class="code-block">
                                        <pre><code class="language-bash"># Check node resources
kubectl top nodes
kubectl describe nodes</code></pre>
                                    </div>
                                </li>
                                <li><strong>Secret Issues:</strong> Verify all secrets exist
                                    <div class="code-block">
                                        <pre><code class="language-bash"># Check secrets
kubectl get secrets -n composio
kubectl describe secret composio-composio-secrets -n composio
kubectl describe secret composio-composio-secrets -n composio</code></pre>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Service Not Accessible</h3>
                        <div class="issue-content">
                            <h4>Symptoms:</h4>
                            <ul>
                                <li>Cannot connect to Apollo API</li>
                                <li>Connection timeouts</li>
                            </ul>

                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check service status
kubectl get svc -n composio

# Test service connectivity from within cluster
kubectl run test-pod --rm -i --tty --image=curlimages/curl --restart=Never -- \
    curl http://composio-apollo:9900/api/v1/health

# Check endpoints
kubectl get endpoints -n composio</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Verify pods are running and ready</li>
                                <li>Check service selectors match pod labels</li>
                                <li>Verify network policies aren't blocking traffic</li>
                                <li>Use port-forward for debugging:
                                    <div class="code-block">
                                        <pre><code class="language-bash">kubectl port-forward -n composio svc/composio-apollo 8080:9900</code></pre>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="knative" class="troubleshoot-section">
                    <h2><i class="fas fa-server"></i> Knative Issues</h2>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Knative Components Not Starting</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check Knative installation
kubectl get pods -n knative-serving

# Check Knative setup job
kubectl get jobs -n composio -l app.kubernetes.io/component=knative-setup
kubectl logs -n composio job/knative-setup-&lt;revision&gt;

# Verify CRDs
kubectl get crd | grep knative</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Reinstall Knative components:
                                    <div class="code-block">
                                        <pre><code class="language-bash">kubectl apply -f https://github.com/knative/serving/releases/download/knative-v1.15.0/serving-crds.yaml
kubectl apply -f https://github.com/knative/serving/releases/download/knative-v1.15.0/serving-core.yaml
kubectl apply -f https://github.com/knative/net-kourier/releases/download/knative-v1.15.0/kourier.yaml

kubectl patch configmap/config-network \
    --namespace knative-serving \
    --type merge \
    --patch '{"data":{"ingress-class":"kourier.ingress.networking.knative.dev"}}'</code></pre>
                                    </div>
                                </li>
                                <li>Ensure cluster has sufficient resources</li>
                                <li>Check for conflicting ingress controllers</li>
                            </ul>
                        </div>
                    </div>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Mercury Service Not Ready</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check Knative service status
kubectl get ksvc -n composio
kubectl describe ksvc composio-mercury -n composio

# Check Mercury pods
kubectl get pods -n composio -l serving.knative.dev/service=composio-mercury

# View Mercury logs
kubectl logs -n composio -l serving.knative.dev/service=composio-mercury</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Check autoscaler annotations are correct</li>
                                <li>Verify resource requests don't exceed cluster capacity</li>
                                <li>Check Mercury container logs for application errors</li>
                                <li>Ensure Knative activator is running</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="database" class="troubleshoot-section">
                    <h2><i class="fas fa-database"></i> Database Issues</h2>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Database Connection Failures</h3>
                        <div class="issue-content">
                            <h4>Symptoms:</h4>
                            <ul>
                                <li>Apollo/Thermos pods failing to start</li>
                                <li>Error messages about database connectivity</li>
                            </ul>

                            <h4>Diagnosis:</h4>
                            <div class="code-block">
<pre><code class="language-bash"># Check database secret
kubectl get secret composio-composio-secrets -n composio -o yaml

# Decode database URL
kubectl get secret composio-composio-secrets -n composio \
    -o jsonpath='{.data.POSTGRES_URL}' | base64 -d

# Test connectivity from pod
kubectl run test-db --rm -i --tty --image=postgres:15 --restart=Never -- \
    psql "$(kubectl get secret composio-composio-secrets -n composio -o jsonpath='{.data.POSTGRES_URL}' | base64 -d)"

# Check Apollo logs for connection errors
kubectl logs -n composio deployment/composio-apollo | grep -i "database\|postgres"</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Verify POSTGRES_URL format is correct:
                                    <code>postgresql://user:password@host:5432/database?sslmode=require</code>
                                </li>
                                <li>Check network connectivity to database</li>
                                <li>Verify database firewall rules allow cluster IPs</li>
                                <li>Ensure SSL mode matches database configuration</li>
                                <li>Re-run secret setup script:
                                    <div class="code-block">
                                        <pre><code class="language-bash">export POSTGRES_URL="your-connection-string"
./secret-setup.sh -r composio -n composio</code></pre>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Database Initialization Job Failures</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check DB init jobs
kubectl get jobs -n composio | grep db-init

# Check job logs
kubectl logs -n composio job/composio-apollo-db-init
kubectl logs -n composio job/composio-thermos-db-init</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Check database permissions for migrations</li>
                                <li>Verify database schema compatibility</li>
                                <li>Delete and recreate failed jobs:
                                    <div class="code-block">
                                        <pre><code class="language-bash">kubectl delete job composio-apollo-db-init -n composio
helm upgrade composio ./composio -n composio</code></pre>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="gke" class="troubleshoot-section">
                    <h2><i class="fab fa-google"></i> GKE-Specific Issues</h2>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> GKE Autopilot Resource Issues</h3>
                        <div class="issue-content">
                            <h4>Symptoms:</h4>
                            <ul>
                                <li>Pods rejected with resource limit errors</li>
                                <li>Autopilot adjusting resource requests</li>
                            </ul>

                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check Autopilot events
kubectl get events -n composio --sort-by='.lastTimestamp' | grep autopilot

# Check resource quotas
kubectl describe quota -n composio

# View Autopilot recommendations
gcloud container clusters describe $CLUSTER_NAME --region=$REGION \
    --format="value(autopilot.workloadPolicyConfig)"</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Ensure resource requests are within Autopilot limits</li>
                                <li>Disable privileged containers and sysctls (Autopilot restriction)</li>
                                <li>Use appropriate QoS classes for pods</li>
                                <li>Review and adjust resource limits in values.yaml</li>
                            </ul>
                        </div>
                    </div>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Cloud SQL Connectivity</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Test Cloud SQL connectivity
kubectl run -it --rm debug --image=postgres:15 --restart=Never -- \
    psql "postgresql://postgres:your_password@${POSTGRES_IP}:5432/composio?sslmode=require"

# Check Cloud SQL logs
gcloud logging read \
    "resource.type=gce_instance AND resource.labels.instance_id:composio-postgres" \
    --limit 50 --format json

# Verify instance status
gcloud sql instances describe composio-postgres</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Ensure Cloud SQL instance allows connections from GKE cluster</li>
                                <li>Check VPC network connectivity</li>
                                <li>Verify SSL certificates are valid</li>
                                <li>Use Cloud SQL Proxy for enhanced security:
                                    <div class="code-block">
                                        <pre><code class="language-bash"># Install Cloud SQL Proxy sidecar
# See: https://cloud.google.com/sql/docs/postgres/connect-kubernetes-engine</code></pre>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="resources" class="troubleshoot-section">
                    <h2><i class="fas fa-memory"></i> Resource Issues</h2>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Out of Memory (OOM)</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check for OOM kills
kubectl get events -n composio | grep OOM

# Check current resource usage
kubectl top pods -n composio
kubectl top nodes

# Describe pod to see resource limits
kubectl describe pod &lt;pod-name&gt; -n composio</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li>Increase memory limits in values.yaml</li>
                                <li>Enable HPA to distribute load</li>
                                <li>Check for memory leaks in application logs</li>
                                <li>Optimize application configuration</li>
                            </ul>
                        </div>
                    </div>

                    <div class="issue-card">
                        <h3><i class="fas fa-times-circle"></i> Persistent Volume Issues</h3>
                        <div class="issue-content">
                            <h4>Diagnosis:</h4>
                            <div class="code-block">
                                <pre><code class="language-bash"># Check PVC status
kubectl get pvc -n composio

# Check PV status
kubectl get pv

# Describe PVC
kubectl describe pvc &lt;pvc-name&gt; -n composio</code></pre>
                            </div>

                            <h4>Solutions:</h4>
                            <ul>
                                <li><strong>Multi-Attach Error:</strong> Minio uses RollingUpdate strategy with maxUnavailable=1</li>
                                <li>Verify storage class is available</li>
                                <li>Check cluster has storage provisioner</li>
                                <li>Delete pod to force remount if stuck</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="debugging" class="troubleshoot-section">
                    <h2><i class="fas fa-bug"></i> Debugging Tools & Commands</h2>

                    <div class="debug-tools">
                        <h3><i class="fas fa-terminal"></i> Essential Debug Commands</h3>

                        <div class="code-block">
                            <pre><code class="language-bash"># Complete cluster overview
kubectl get all -n composio

# Pod logs (follow)
kubectl logs -f &lt;pod-name&gt; -n composio

# Previous pod logs (after crash)
kubectl logs &lt;pod-name&gt; -n composio --previous

# Multi-container pod logs
kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n composio

# Execute commands in pod
kubectl exec -it &lt;pod-name&gt; -n composio -- /bin/sh

# Port forward for local access
kubectl port-forward -n composio svc/composio-apollo 8080:9900

# Watch resource changes
watch kubectl get pods -n composio

# Get pod YAML
kubectl get pod &lt;pod-name&gt; -n composio -o yaml

# Check pod events
kubectl describe pod &lt;pod-name&gt; -n composio

# Network debugging
kubectl run netshoot --rm -i --tty --image=nicolaka/netshoot --restart=Never

# DNS debugging
kubectl run dnsutils --rm -i --tty --image=gcr.io/kubernetes-e2e-test-images/dnsutils:1.3 --restart=Never -- nslookup composio-apollo.composio.svc.cluster.local</code></pre>
                        </div>

                        <h3><i class="fas fa-chart-line"></i> Monitoring Commands</h3>

                        <div class="code-block">
                            <pre><code class="language-bash"># Resource usage
kubectl top pods -n composio
kubectl top nodes

# HPA status
kubectl get hpa -n composio
kubectl describe hpa &lt;hpa-name&gt; -n composio

# Service endpoints
kubectl get endpoints -n composio

# ConfigMaps and Secrets
kubectl get cm -n composio
kubectl get secrets -n composio

# Knative services
kubectl get ksvc -n composio
kubectl get revisions -n composio</code></pre>
                        </div>

                        <h3><i class="fas fa-tools"></i> Support Bundle Collection</h3>

                        <p>For complex issues, collect a comprehensive support bundle:</p>

                        <div class="code-block">
                            <pre><code class="language-bash"># Enable support bundle in values.yaml
supportBundle:
  enabled: true

# Upgrade deployment
helm upgrade composio ./composio -n composio

# Collect support bundle
kubectl support-bundle ./composio/support-bundle-spec.yaml -n composio

# Or manually collect key information
mkdir support-bundle
kubectl get all -n composio -o yaml > support-bundle/all-resources.yaml
kubectl get events -n composio --sort-by='.lastTimestamp' > support-bundle/events.txt
kubectl logs -n composio --all-containers=true --prefix=true > support-bundle/all-logs.txt
kubectl describe nodes > support-bundle/nodes.txt</code></pre>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h2><i class="fas fa-life-ring"></i> Getting Help</h2>

                    <div class="help-grid">
                        <div class="help-card">
                            <i class="fab fa-discord"></i>
                            <h3>Discord Community</h3>
                            <p>Get real-time help from the community and maintainers</p>
                            <a href="https://discord.gg/composio" class="btn btn-primary" target="_blank">Join Discord</a>
                        </div>

                        <div class="help-card">
                            <i class="fab fa-github"></i>
                            <h3>GitHub Issues</h3>
                            <p>Report bugs and request features</p>
                            <a href="https://github.com/composio/helm-charts/issues" class="btn btn-primary" target="_blank">Open Issue</a>
                        </div>

                        <div class="help-card">
                            <i class="fas fa-book"></i>
                            <h3>Documentation</h3>
                            <p>Explore comprehensive guides and API references</p>
                            <a href="https://docs.composio.dev" class="btn btn-primary" target="_blank">Read Docs</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Documentation</h3>
                    <ul>
                        <li><a href="architecture.html">Architecture</a></li>
                        <li><a href="configuration.html">Configuration</a></li>
                        <li><a href="guides.html">Cloud Provider Guides</a></li>
                        <li><a href="troubleshooting.html">Troubleshooting</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="changelog.html">Changelog</a></li>
                        <li><a href="load-tests.html">Load Tests</a></li>
                        <li><a href="https://github.com/composio/helm-charts">GitHub</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="https://discord.gg/composio">Discord Community</a></li>
                        <li><a href="https://docs.composio.dev">Composio Docs</a></li>
                        <li><a href="mailto:support@composio.dev">Email Support</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Composio. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="assets/script.js"></script>
</body>
</html>

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-apollo-config
  labels:
    app: apollo
    release: {{ .Release.Name }}
data:
  PORT: "9900"
  HOSTNAME: "0.0.0.0"
  NODE_ENV: "production"
  {{- if and .Values.apollo.googleServiceAccount .Values.apollo.googleServiceAccount.enabled }}
  GOOGLE_APPLICATION_CREDENTIALS: "{{ .Values.apollo.googleServiceAccount.mountPath }}/key.json"
  {{- end }}
  AWS_REGION: {{ .Values.aws.region | quote }}
  COMPOSIO_ENV: "production"
  USE_CLICKHOUSE_FOR_LOGS: "false"
  SELF_HOSTED: "true"
  NODE_OPTIONS: "--max-old-space-size=4096"
  THERMOS_URL: {{ printf "http://%s-thermos:8180" .Release.Name | quote }}
  BACKEND_URL: {{ .Values.apollo.overwrite_apollo_url | default (printf "http://%s-apollo:9900" .Release.Name) | quote }}
  {{- if .Values.apollo.overwrite_fe_url }}
  OVERWRITE_FE_URL: {{ .Values.apollo.overwrite_fe_url | quote }}
  {{- end }}
  OVERWRITE_APOLLO_URL: {{ .Values.apollo.overwrite_apollo_url | default (printf "http://%s-apollo:9900" .Release.Name) | quote }}
  OAUTH2_REDIRECT_URI_OVERRIDE: {{ .Values.apollo.oauth2_redirect_uri_override | default (printf "http://%s-apollo:9900/api/v3/toolkits/auth/callback" .Release.Name) | quote }}
  MERCURY_URL: "https://mercury.composio.dev"
  S3_FORCE_PATH_STYLE: {{ .Values.apollo.s3ForcePathStyle | default "true" | quote }}
  S3_ENDPOINT: {{ .Values.apollo.s3Endpoint | quote }}
  S3_ENDPOINT_URL: {{ .Values.apollo.s3EndpointUrl | quote }}
  S3_REGION: {{ .Values.apollo.s3Region | quote }}
  S3_SIGNATURE_VERSION: {{ .Values.apollo.s3SignatureVersion | quote }}
  OBJECT_STORAGE_BACKEND: {{ .Values.apollo.objectStorage.backend | default "s3" | quote }}
  {{- if .Values.apollo.objectStorage.namespaces.temp }}
  TEMP_STORAGE_NAMESPACE: {{ .Values.apollo.objectStorage.namespaces.temp | quote }}
  {{- end }}
  {{- if .Values.apollo.objectStorage.namespaces.permanent }}
  PERMANENT_STORAGE_NAMESPACE: {{ .Values.apollo.objectStorage.namespaces.permanent | quote }}
  {{- end }}
  SERVICE_NAME: "apollo"
  APOLLO_URL: {{ .Values.apollo.apollo_url | default (printf "http://%s-apollo:9900" .Release.Name) | quote }}
  MAX_AUTH_FAILURES_FOR_EXPIRY: "1"
  {{- if or (.Values.apollo.frontendUrl) (.Values.apollo.overwrite_fe_url) }}
  FRONTEND_URL: {{ (.Values.apollo.overwrite_fe_url | default .Values.apollo.frontendUrl | default (printf "https://app.%s" .Values.global.domain)) | quote }}
  {{ end }}
  {{- if .Values.apollo.useStaticLogos }}
  USE_STATIC_LOGOS: "true"
  {{ end }}
  NEXT_PUBLIC_DISABLE_SOCIAL_LOGIN: {{ .Values.apollo.nextPublicDisableSocialLogin | quote }}
  {{- if .Values.otel.enabled }}
  OTEL_ENABLED: {{ .Values.otel.enabled | quote }}
  OTEL_SERVICE_NAME: {{ .Values.otel.apollo.serviceName | default "apollo" | quote }}
  OTEL_SERVICE_VERSION: {{ .Values.otel.apollo.serviceVersion | default "1.0.0" | quote }}
  OTEL_ENVIRONMENT: {{ .Values.otel.environment | default .Values.global.environment | default "development" | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.otel.exporter.otlp.endpoint | default (printf "%s-otel-collector:4317" .Release.Name) | quote }}
  OTEL_EXPORTER_OTLP_TRACES_ENDPOINT: {{ .Values.otel.exporter.otlp.tracesEndpoint | default (printf "%s-otel-collector:4317" .Release.Name) | quote }}
  OTEL_EXPORTER_OTLP_INSECURE: {{ .Values.otel.exporter.otlp.insecure | default "true" | quote }}
  OTEL_TRACES_EXPORTER: "otlp"
  OTEL_METRICS_EXPORTER: "otlp"
  OTEL_LOGS_EXPORTER: "otlp"
  ENABLE_OTEL_METRICS: {{ .Values.otel.metrics.enabled | default "true" | quote }}
  OTEL_METRICS_ENDPOINT: {{ .Values.otel.apollo.metricsEndpoint | default (printf "http://%s-otel-collector:4318/v1/metrics" .Release.Name) | quote }}
  OTEL_RESOURCE_ATTRIBUTES: "service.name={{ .Values.otel.apollo.serviceName | default "apollo" }},service.version={{ .Values.otel.apollo.serviceVersion | default "1.0.0" }},deployment.environment={{ .Values.otel.environment | default .Values.global.environment | default "development" }}"
  {{- end }}
  SMTP_AUTHOR_EMAIL: {{ .Values.apollo.smtp.smtpAuthorEmail | quote }}
  S3_BUCKET: {{ .Values.apollo.s3Bucket | quote }}
  TEST_DEBUG: "true"
  SIDECAR_FILE_CACHE_PATH: "/base/sidecar_export.json"
  {{- if .Values.weaviate.enabled }}
  WEAVIATE_URL: {{ printf "http://%s-weaviate:%v" .Release.Name (.Values.weaviate.service.port | default 8080) | quote }}
  WEAVIATE_HOST: {{ printf "%s-weaviate" .Release.Name | quote }}
  WEAVIATE_PORT: {{ .Values.weaviate.service.port | default 8080 | quote }}
  WEAVIATE_COLLECTION: {{ .Values.apollo.search.weaviate.collection | default "ToolSchemas" | quote }}
  {{- if .Values.apollo.search.weaviate.apiKey }}
  WEAVIATE_API_KEY: {{ .Values.apollo.search.weaviate.apiKey | quote }}
  {{- end }}
  {{- end }}
  {{- if .Values.apollo.search.enabled }}
  # Master Toggle
  UNIFIED_SEARCH_ENABLED: {{ .Values.apollo.search.unified.enabled | default false | toString | quote }}
  # Vector Store Provider Selection
  {{- if .Values.weaviate.enabled }}
  VECTOR_STORE_PROVIDER: {{ .Values.apollo.search.vectorStoreProvider | default "weaviate" | quote }}
  {{- if .Values.apollo.search.unified.enabled }}
  UNIFIED_VECTOR_STORE_PROVIDER: {{ .Values.apollo.search.unified.vectorStoreProvider | default "weaviate" | quote }}
  {{- end }}
  {{- end }}
  # Embeddings Provider Configuration
  {{- if .Values.openAI.enabled }}
  EMBEDDINGS_PROVIDER: {{ .Values.apollo.search.embeddings.provider | default "openai" | quote }}
  EMBEDDINGS_MODEL: {{ .Values.apollo.search.embeddings.model | default "text-embedding-3-large" | quote }}
  EMBEDDINGS_DIMENSIONS: {{ .Values.apollo.search.embeddings.dimensions | default 1024 | toString | quote }}
  {{- if .Values.apollo.search.unified.enabled }}
  UNIFIED_EMBEDDINGS_PROVIDER: {{ .Values.apollo.search.unified.embeddings.provider | default "openai" | quote }}
  UNIFIED_EMBEDDINGS_MODEL: {{ .Values.apollo.search.unified.embeddings.model | default "text-embedding-3-large" | quote }}
  UNIFIED_EMBEDDINGS_DIMENSIONS: {{ .Values.apollo.search.unified.embeddings.dimensions | default 1024 | toString | quote }}
  {{- end }}
  {{- end }}
  # Unified Search Index Configuration
  {{- if .Values.apollo.search.unified.enabled }}
  UNIFIED_VECTOR_STORE_INDEX_TOOL: {{ .Values.apollo.search.unified.indexTool | default "ToolData" | quote }}
  UNIFIED_VECTOR_STORE_INDEX_PLAN: {{ .Values.apollo.search.unified.indexPlan | default "UsecasePlans" | quote }}
  {{- end }}
  # Reranker Configuration
  RERANKER_MODEL: {{ .Values.apollo.search.reranker.model | default "openai:gpt-5.2" | quote }}
  {{- if .Values.apollo.search.reranker.openaiCompatBaseUrl }}
  RERANKER_OPENAI_COMPAT_BASE_URL: {{ .Values.apollo.search.reranker.openaiCompatBaseUrl | quote }}
  {{- else }}
  RERANKER_OPENAI_COMPAT_BASE_URL: "https://api.openai.com/v1"
  {{- end }}
  {{- end }}

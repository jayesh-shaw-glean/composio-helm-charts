suite: test helper functions
templates:
  - apollo/apollo.yaml  # Using apollo as a test template since helpers are included
tests:
  - it: should generate correct name with composio.name helper
    documentIndex: 1
    set:
      redis.enabled: true
      externalRedis.enabled: false
    asserts:
      - equal:
          path: metadata.name
          value: RELEASE-NAME-apollo  # This uses the helper function

  - it: should generate labels with composio.labels helper
    documentIndex: 1
    set:
      redis.enabled: true
      externalRedis.enabled: false
    asserts:
      - equal:
          path: metadata.labels.app
          value: apollo
      - equal:
          path: metadata.labels.release
          value: RELEASE-NAME

  - it: should use custom name override
    documentIndex: 1
    set:
      redis.enabled: true
      externalRedis.enabled: false
      nameOverride: custom-name
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ".*custom-name.*"

  - it: should use fullname override
    documentIndex: 1
    set:
      redis.enabled: true
      externalRedis.enabled: false
      fullnameOverride: full-custom-name
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: ".*full-custom-name.*"

---
suite: test namespace helper
templates:
  - mercury/mercury.yaml  # Using mercury as it uses namespace helper
tests:
  - it: should use default namespace when create is false
    set:
      namespace.create: false
      namespace.name: default
      mercury.enabled: true
      mercury.useKnative: false
    asserts:
      - equal:
          path: metadata.namespace
          value: default

  - it: should use custom namespace
    set:
      namespace.name: custom-namespace
      mercury.enabled: true
      mercury.useKnative: false
    asserts:
      - equal:
          path: metadata.namespace
          value: custom-namespace
